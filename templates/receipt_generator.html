{% extends 'layout.html' %}
{% block content %}

<div class="container mx-auto p-6">
Â  Â  <h1 class="text-3xl font-bold text-gray-800 mb-6">Receipt Generator</h1>

Â  Â  <form method="GET" action="{{ url_for('receipt_generator_index') }}" class="mb-8 flex shadow-md rounded-lg overflow-hidden border border-gray-300">
Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  Â  name="search_query"Â 
Â  Â  Â  Â  Â  Â  placeholder="ðŸ” Search by name or reg number..."Â 
Â  Â  Â  Â  Â  Â  value="{{ search_query or '' }}"
Â  Â  Â  Â  Â  Â  class="flex-grow border-0 p-3 focus:ring focus:ring-indigo-200 focus:outline-none"
Â  Â  Â  Â  >
Â  Â  Â  Â  <buttonÂ 
Â  Â  Â  Â  Â  Â  type="submit"Â 
Â  Â  Â  Â  Â  Â  class="bg-indigo-600 text-white px-6 font-semibold hover:bg-indigo-700 transition"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Search
Â  Â  Â  Â  </button>
Â  Â  </form>

Â  Â  {% if students_list %}
Â  Â  Â  Â  <p class="text-gray-600 mb-4">
Â  Â  Â  Â  Â  Â  Found <span class="font-semibold">{{ students_list|length }}</span> student(s)
Â  Â  Â  Â  </p>

Â  Â  Â  Â  {% for student in students_list %}
Â  Â  Â  Â  <div class="bg-white shadow-md p-6 mb-6 rounded-lg hover:shadow-lg transition">
Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-semibold text-gray-900 flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  {{ student.name }}Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm text-gray-500">({{ student.reg_number }})</span>
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-2">Class: {{ student.student_class }}</p>

Â  Â  Â  Â  Â  Â  <a
Â  Â  Â  Â  Â  Â  Â  Â  href="{{ url_for('payments', search=student.reg_number) }}"
Â  Â  Â  Â  Â  Â  Â  Â  class="inline-block mb-4 text-indigo-600 text-sm font-medium hover:underline"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  ðŸ“‚ View Full Payment History â†’
Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  {% if student.payments %}
Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full border border-gray-200 rounded-lg text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Date</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Amount</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Type</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Term</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Session</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="p-3 text-left text-gray-700 font-medium">Action</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody class="bg-white divide-y divide-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% for p in student.payments %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="hover:bg-gray-50 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3">{{ p.payment_date.strftime('%Y-%m-%d') }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3 font-semibold text-green-700">â‚¦{{ "{:,.2f}".format(p.amount_paid) }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3">{{ p.payment_type }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3">{{ p.term }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3">{{ p.session }}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="p-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <aÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  href="{{ url_for('payment_receipt', payment_id=p.id) }}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target="_blank"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 transition"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ðŸ§¾ View Receipt
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-500 mt-3 italic">âš  No payments recorded yet for this student.</p>
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {% endfor %}
Â  Â  {% else %}
Â  Â  Â  Â  <div class="text-center text-gray-500 mt-12">
Â  Â  Â  Â  Â  Â  <p class="text-lg">No students found. Try searching by name or registration number.</p>
Â  Â  Â  Â  Â  Â  <p class="mt-2">ðŸ’¡ Tip: Double-check spelling or spacing in your search.</p>
Â  Â  Â  Â  </div>
Â  Â  {% endif %}

</div>
{% endblock %}
